<!-- CONTENIDO -->
<main class="p-2">
	<div class="card p-3">
		<div class="container">
			<h4 class="mt-3 mb-3">PUNTO DE VENTA</h4>
			<app-loading *ngIf="is_loading"></app-loading>

			<div class="form-row">
				<div [ngClass]="{'block':show_name_input,'col-7':true}">
					<label>Cliente</label>
					<input type="" [(ngModel)]="datosVenta.venta.cliente" class="form-control" placeholder="PUBLICO GENERAL">
				</div>
				<div class="col">
					<label>Tipo Cliente</label>
					<select [(ngModel)]="datosVenta.venta.id_tipo_precio" class="form-control col" (change)="changeTipoCliente($event.target.value)" [(ngModel)]="datosVenta.venta.id_tipo_precio">
						<option *ngFor="let tipo_precio of tipo_precios" [value]="tipo_precio.id">{{tipo_precio.nombre |  uppercase}}</option>
					</select>
				</div>
			</div>

			<div class="dropdown mb-3">
				<div class="mt-3">
					<input type="text" (keyup)="buscar($event)" [(ngModel)]="busqueda" class="form-control" placeholder="Buscar...">
				</div>
				<div *ngIf="search_servicios.length && busqueda != ''" class="dropdown-menu show w-100 no-selectable-text">
					<div *ngFor="let servicio of search_servicios;let i=index" (click)="agregarServicio(servicio)">
						<!--div *ngIf="i>0" class="dropdown-divider"></div -->
						<div class="dropdown-item search">
							{{servicio.nombre|uppercase}}
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="container card mt-3 mb-3 pt-3 pb-3">
			<ul class="list-group">
				<li class="list-group-item"  *ngFor="let sd of datosVenta.detalles">
					<div class="row">
						<label class="col form-check-label">{{sd.servicio.nombre | titlecase}}</label>
						<div class="col input-group">
							<input type="number" [(ngModel)]="sd.detalle_venta.cantidad" step="1" min=0 class="form-control">
							<div class="input-group-append">
								<button class="btn btn-outline-secondary btn-primary color-primary pr-3 pl-3">-</button>
								<button class="btn btn-outline-secondary btn-secondary color-primary pr-3 pl-3">+</button>
								<button class="btn btn-outline-secondary btn-danger color-primary pr-3 pl-3">x</button>
							</div>
						</div>
					</div>
				</li>
			</ul>
			<div>
				total {{total}}
				{{show_modal_pago?'YES':'NO'}}
			</div>
		</div>
	</div>
</main>
<footer class="card w-100">
	<div class="m-auto text-center" *ngIf="procesando_pago">
		<div class="spinner-border text-success" role="status">
			<span class="sr-only">Loading...</span>
		</div>
	</div>

	<div class="row">
		<div class="col">{{datosVenta.venta.total}}</div>
		<div class="col"></div>
		<div class="col">{{datosVenta.venta.subtotal}}</div>
		<div class="col">{{datosVenta.venta.iva}}</div>
		<div class="col text-center mt-3 mb-3">
			<button type="button" class="btn btn-primary btn-lg  w-75" (click)="guardarVenta()" [disabled]="show_creando_venta">Pagar</button>
		</div>
	</div>
</footer>

<app-modal [(show)]="show_modal_pago">
	<div class="p-3 m-3 border-box">
		<div class="form-group row">
			<label class="col-form-label m-1">Efectivo: </label>
			<div class="m-1">
				<input type="number" class="form-control" name="efectivo" [(ngModel)]="pago.efectivo">
			</div>
		</div>

		<div class="form-group row">
			<label class="col-form-label m-1">Dolares: </label>
			<div class="m-1">
				<input type="number" class="form-control" name="dolares" [(ngModel)]="pago.dolares">
			</div>
		</div>


		<div class="form-group row">
			<label class="col-form-label m-1">Tarjeta: </label>
			<div class="m-1">
				<input type="number" class="form-control" name="cheques" [(ngModel)]="pago.tarjeta">
			</div>
		</div>

		<div class="m-auto text-center" *ngIf="procesando_pago">
			<div class="spinner-border text-success" role="status">
				<span class="sr-only">Loading...</span>
			</div>
		</div>
		<div>Total: {{pago.total | currency }}</div>
		<div>Total en Dlls: {{pago.total/pago.tipo_cambio_dolares | currency }}</div>
		<div>Cantidad a Pagar {{infoPago.cantidad_faltante}}</div>
		<div>
			{{ pago.efectivo }}
			{{ pago.dolares}}
			{{ pago.tipo_cambio_dolares}}
			{{ pago.dolares*pago.tipo_cambio_dolares}}
			{{ pago.tarjeta }}
			{{ pago.cheque | currency}}
			{{ pago.deposito | currency }}
			{{ pago.total | currency }}
		</div>
		<div *ngIf="pago.dolares>0">En Dlls{{pago.dolares*pago.tipo_cambio_dolares}}</div>
		<div>Cambio: {{ (0+pago.efectivo
							+(pago.dolares*pago.tipo_cambio_dolares)
							+pago.tarjeta
							+pago.cheque
							+pago.deposito - pago.total )> 0 ?
							(
								0+pago.efectivo
								+(pago.dolares*pago.tipo_cambio_dolares)
								+pago.tarjeta
								+pago.cheque
								+pago.deposito
								- pago.total
							)
							: 10 | currency}}</div>
		{{ (
			pago.efectivo
			+ (pago.dolares * pago.tipo_cambio_dolares)
			+ ( pago.tarjeta )
			+ ( pago.cheque )
			+ ( pago.deposito )
			- ( pago.total )
		)|currency }}
		<div>
			<button type="button" class="btn btn-primary" [disabled]="procesando_pago && infoPago.cantidad_faltante > 0" (click)="pagarVenta()">Pagar</button>
		</div>
	</div>
</app-modal>

